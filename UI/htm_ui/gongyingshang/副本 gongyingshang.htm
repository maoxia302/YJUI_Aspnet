<script type="text/javascript">
    var flag;
    $(function () {
        $("#dg_gongyingshang").datagrid({
            url: "../ashx_ui/ui_gongyingshang.ashx?action=search",
            idField: 'id',
            fit: true,
            fitColumns: false,
            singleSelect: true,
            nowrap: false,
            pagination: true,
            rownumbers: true,
            pageSize: 40,
            pageList: [40, 50],
            //冻结列
            frozenColumns: [
                [{ "title": "厂家到货信息", "colspan": 10}],
                [
                    { field: "id", title: "编号", width: 50 },
                    { field: "regdate", title: "登记时间", width: 120 },
                    { field: "regperson", title: "登记人", width: 60 },
                    { field: "arrdate", title: "到货时间", width: 120 },
                    { field: "dep", title: "部门", width: 120 },
                    { field: "cate", title: "分类", width: 120 },
                    { field: "category", title: "品类", width: 120 },
                    { field: "suppliername", title: "厂家名称", width: 150 },
                    { field: "suppliertel", title: "厂家电话", width: 120 },
                    { field: "total", title: "总件数", width: 50 }
                ]
            ],
            columns: [
                [{ "title": "卸车", "colspan": 4 }, { title: "质检", colspan: 4 }, { title: "未成品收货", colspan: 5 }, { title: "成品收货", colspan: 5 }, { title: "包装收货", colspan: 5 }, { title: "非自有收货", colspan: 5 }, { title: "赠品收货", colspan: 5 }, { title: "未成品入库", colspan: 5 }, { title: "成品入库", colspan: 5 }, { title: "包装入库", colspan: 5 }, { title: "非自有入库", colspan: 5 }, { title: "赠品入库", colspan: 5 }, { title: "不良品转入", colspan: 5 }, { title: "重工库转入", colspan: 5 }, { title: "总完成时间", colspan: 1 }, { title: "是否全部入库", colspan: 1}],
                [
                    { field: "uploadstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "uploadrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.uploadrealdate > row.uploadstddate) {
                            return '<p style="color:red">'+value+'</p>';
                        } else {
                            return value;
                        }

                    } },
                    { field: "uploadperson", title: "操作人", width: 80 },
                    { field: "uploaddate", title: "操作时间", width: 120 },
                    { field: "uploadremark", title: "原因", width: 120 },
                    //质检操作
                    { field: "teststddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "testrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.testrealdate > row.teststddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    {field: "testperson", title: "操作人", width: 80 },
                    { field: "testdate", title: "操作时间", width: 120 },
                     { field: "testremark", title: "原因", width: 120 },
            //未成品收货
                    {field: "wRecstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "wRecrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.wRecrealdate > row.wRecstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                      //{ field: "recnums", title: "件数", width: 80 },
                    {field: "wRecnum", title: "数量", width: 80 },
                     { field: "wRecremark", title: "备注", width: 80 },
                    { field: "wRecperson", title: "操作人", width: 80 },
                    { field: "wRecdate", title: "操作时间", width: 120 },
            //成品收货
                    {field: "cRecstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "cRecrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.cRecrealdate > row.cRecstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                     // { field: "wRecnums", title: "件数", width: 80 },
                    { field: "cRecnum", title: "数量", width: 80 },
                    { field: "cRecperson", title: "操作人", width: 80 },
                    { field: "cRecdate", title: "操作时间", width: 120 },
                    { field: "cRecremark", title: "备注", width: 80 },
            //包装收货
                    {field: "bRecstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "bRecrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.bRecrealdate > row.bRecstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
            // { field: "wRecnums", title: "件数", width: 80 },
                    {field: "bRecnum", title: "数量", width: 80 },
                    { field: "bRecperson", title: "操作人", width: 80 },
                    { field: "bRecdate", title: "操作时间", width: 120 },
                    { field: "bRecremark", title: "备注", width: 80 },
            //非自有收货
                    {field: "fRecstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "fRecrealdate", title: "实际完成时间", width: 120,formatter: function (value, row) {
                        if (row.fRecrealdate > row.fRecstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    }  },
            // { field: "wRecnums", title: "件数", width: 80 },
                    {field: "fRecnum", title: "数量", width: 80 },
                    { field: "fRecperson", title: "操作人", width: 80 },
                    { field: "fRecdate", title: "操作时间", width: 120 },
                    { field: "fRecremark", title: "备注", width: 80 },

            //非自有收货
                    {field: "zRecstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "zRecrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.zRecrealdate > row.zRecstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
            // { field: "wRecnums", title: "件数", width: 80 },
                    {field: "zRecnum", title: "数量", width: 80 },
                    { field: "zRecperson", title: "操作人", width: 80 },
                    { field: "zRecdate", title: "操作时间", width: 120 },
                    { field: "zRecremark", title: "备注", width: 80 },

            //未成品入库
                    {field: "unfinishstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "unfinishrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.unfinishrealdate > row.unfinishstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "unfinishnum", title: "数量", width: 80 },
                    { field: "unfinishremark", title: "备注", width: 80 },
                    { field: "unfinishperson", title: "操作人", width: 80 },
                    { field: "unfinishdate", title: "操作时间", width: 120 },
            //成品入库
                    {field: "finishstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "finishrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.finishrealdate > row.finishstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "finishnum", title: "数量", width: 80 },
                    { field: "finishremark", title: "备注1", width: 80 },
                    { field: "finishperson", title: "操作人", width: 80 },
                    { field: "finishdate", title: "操作时间", width: 120 },
            //包装入库
                    {field: "packstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "packrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.packrealdate > row.packstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "packnum", title: "数量", width: 80 },
                    { field: "packremark", title: "备注", width: 80 },
                    { field: "packperson", title: "操作人", width: 80 },
                    { field: "packdate", title: "操作时间", width: 120 },

            //非自有入库                                     
                    {field: "noselfstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "noselfrealdate", title: "实际完成时间", width: 120,formatter: function (value, row) {
                        if (row.testrealdate > row.teststddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    }  },
                    { field: "noselfnum", title: "数量", width: 80 },
                    { field: "noselfremark", title: "备注", width: 80 },
                    { field: "noselfperson", title: "操作人", width: 80 },
                    { field: "noselfdate", title: "操作时间", width: 120 },

            //赠品入库                                     
                    {field: "giftstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "giftrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.testrealdate > row.teststddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "giftnum", title: "数量", width: 80 },
                    { field: "giftremark", title: "备注", width: 80 },
                    { field: "giftperson", title: "操作人", width: 80 },
                    { field: "giftdate", title: "操作时间", width: 120 },
            //不良品库转入
                    {field: "badstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "badrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.badrealdate > row.badstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "badnum", title: "数量", width: 80 },
                    { field: "badremark", title: "备注", width: 80 },
                    { field: "badperson", title: "操作人", width: 80 },
                    { field: "baddate", title: "操作时间", width: 120 },
            //重工库转入
                    {field: "reworkstddate", title: "标准完成时间", width: 120, hidden: true },
                    { field: "reworkrealdate", title: "实际完成时间", width: 120, formatter: function (value, row) {
                        if (row.reworkrealdate > row.reworkstddate) {
                            return '<p style="color:red">' + value + '</p>';
                        } else {
                            return value;
                        }

                    } 
                    },
                    { field: "reworknum", title: "数量", width: 120 },
                    { field: "reworkremark", title: "备注", width: 80 },
                    { field: "reworkperson", title: "操作人", width: 80 },
                    { field: "reworkdate", title: "操作时间", width: 120 },
            //总完成时间
                    {field: "shicha", title: "总使用时间(分钟)", width: 120 },
                    { field: "ruku", title: "是否全部入库", width: 120, formatter: function (value, row) {
                        if (row.total > row.ruku) {
                            return '<p style="color:red">否</p>';
                        } else {
                            return '是';

                        }

                    }
                    }
                ]
            ],
            toolbar: [
                {
                    id: 'a1',
                    text: '添加到货信息',
                    iconCls: 'icon-edit',
                    handler: add_gongyingshang
                },
                {
                    id: 'a2',
                    text: '添加卸车信息',
                    iconCls: 'icon-org',
                    handler: add_xieche
                },
                {
                    id: 'a3',
                    text: '质检',
                    iconCls: 'icon-org',
                    handler: add_zhijian
                },
                {
                    id: 'a4',
                    text: '未成品收货',
                    iconCls: 'icon-org',
                    handler: add_wshouhuo
                },
                                {
                                    id: 'a5',
                                    text: '成品收货',
                                    iconCls: 'icon-org',
                                    handler: add_cshouhuo
                                },
                {
                    id: 'a6',
                    text: '包装收货',
                    iconCls: 'icon-org',
                    handler: add_bshouhuo
                },
                {
                    id: 'a7',
                    text: '非自有收货',
                    iconCls: 'icon-org',
                    handler: add_fshouhuo
                },
                {
                    id: 'a8',
                    text: '赠品收货',
                    iconCls: 'icon-org',
                    handler: add_zshouhuo
                },

                {
                    id: 'a9',
                    text: '未成品入库',
                    iconCls: 'icon-org',
                    handler: add_weichengpin
                },
                {
                    id: 'a10',
                    text: '成品入库',
                    iconCls: 'icon-org',
                    handler: add_chengpin
                },
                {
                    id: 'a11',
                    text: '包装入库',
                    iconCls: 'icon-org',
                    handler: add_baozhuang
                }
                ,
                {
                    id: 'a12',
                    text: '非自有入库',
                    iconCls: 'icon-org',
                    handler: add_feiziyou
                }, {
                    id: 'a13',
                    text: '赠品入库',
                    iconCls: 'icon-org',
                    handler: add_zengpin
                },
                {
                    id: 'a14',
                    text: '不良品入库',
                    iconCls: 'icon-org',
                    handler: add_buliangpin
                },
                {
                    id: 'a15',
                    text: '重工入库',
                    iconCls: 'icon-org',
                    handler: add_chonggong
                }
                ,
                {
                    id: 'a16',
                    text: '违规抽查记录',
                    iconCls: 'icon-org',
                    handler: add_choucha
                }
            ]
        });
        quanxian();
    });

    function add_choucha() {



    }





    function add_gongyingshang() {
        flag = 1;
        $("<div/>").dialog({
            href: "htm_ui/gongyingshang/gongyingshang_add.htm",
            title: "添加供应商到货信息",
            height: 300,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                {
                    text: '确定添加',
                    iconCls: 'icon-add',
                    handler: function () {
                        var d = $(this).closest('.window-body');
                        $("#f_neibutaizhang_add").form("submit", {
                            url: "../ashx_ui/ui_gongyingshang.ashx",
                            onSubmit: function (param) {
                                param.action = 'add';
                                return $(this).form('validate');
                            },
                            success: function (result) {
                                dealAjaxResult(result, function (r) {
                                    d.dialog('destroy');
                                    $.show_warning("提示", "操作成功");
                                    $("#dg_gongyingshang").datagrid("reload");
                                });
                            }
                        });
                    }
                },
                {
                    text: '取消添加',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }
        });
    }
    //卸车2
    function add_xieche() {
        flag = 2;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/xieche_add.htm",
            width: 800,
            height: 600,
            title: "添加卸车信息",
            buttons: [{
                id: 'b2',
                text: '添加卸车信息',
                iconCls: 'icon-edit',
                handler: function () {
                    //alert("");
                    var d = $(this).closest('.window-body');
                    $("#f_xieche_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'xieche';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#regperson").html(r[0].regperson);
                $("#dep").html(r[0].dep);
                $("#cate").html(r[0].cate);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").val(r[0].uploadrealdate);
                $("#uploadremark").val(r[0].uploadremark);
                $("#uploadnum").val(r[0].uploadnum);

            }
        });
        showbutton(flag);
    }
   
    //第3步质检
    function add_zhijian() {
        flag = 3;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/zhijian_add.htm",
            width: 800,
            height: 600,
            title: "添加质检信息",
            buttons: [{
                id: 'b3',
                text: '添加质检信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_zhijian_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'zhijian';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);

                $("#testrealdate").val(r[0].testrealdate);
                $("#testremark").val(r[0].testremark);
            }
        });
        showbutton(flag);
    }
    //第4步，未成品收货
    function add_wshouhuo() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/wshouhuo_add.htm",
            width: 800,
            height: 600,
            title: "添加未成品收货信息",
            buttons: [{
                id: 'b4',
                text: '添加收货信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_wshouhuo_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'wshouhuo';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);
                $("#testrealdate").html(r[0].testrealdate);
                $("#testremark").html(r[0].testremark);
                $("#testperson").html(r[0].testperson);
                $("#recrealdate").val(r[0].recrealdate);
                $("#recnum").val(r[0].recnum);


            }
        });
        showbutton(flag);


    }
    //第4步，成品收货
    function add_cshouhuo() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/cshouhuo_add.htm",
            width: 800,
            height: 600,
            title: "添加成品收货信息",
            buttons: [{
                id: 'b4',
                text: '添加收货信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_cshouhuo_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'cshouhuo';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);
                $("#testrealdate").html(r[0].testrealdate);
                $("#testremark").html(r[0].testremark);
                $("#testperson").html(r[0].testperson);
                //未成品
                $("#cRecrealdate").val(r[0].cRecrealdate);
                $("#cRecnum").val(r[0].cRecnum);
                $("#cRecremark").val(r[0].cRecremark);


            }
        });
        showbutton(flag);


    }

    //第4步，包装收货
    function add_bshouhuo() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/bshouhuo_add.htm",
            width: 800,
            height: 600,
            title: "添加包装收货信息",
            buttons: [{
                id: 'b4',
                text: '添加收货信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_bshouhuo_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'bshouhuo';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);
                $("#testrealdate").html(r[0].testrealdate);
                $("#testremark").html(r[0].testremark);
                $("#testperson").html(r[0].testperson);
                //未成品



                $("#bRecrealdate").val(r[0].bRecrealdate);
                $("#bRecnum").val(r[0].bRecnum);
                $("#bRecremark").val(r[0].bRecremark);


            }
        });
        showbutton(flag);


    }

    //第4步，非自有收货
    function add_fshouhuo() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/fshouhuo_add.htm",
            width: 800,
            height: 600,
            title: "添加非自有收货信息",
            buttons: [{
                id: 'b4',
                text: '添加收货信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_fshouhuo_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'fshouhuo';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);
                $("#testrealdate").html(r[0].testrealdate);
                $("#testremark").html(r[0].testremark);
                $("#testperson").html(r[0].testperson);
                //未成品
                $("#fRecrealdate").val(r[0].bRecrealdate);
                $("#fRecnum").val(r[0].bRecnum);
                $("#fRecremark").val(r[0].bRecremark);


            }
        });
        showbutton(flag);


    }


    //第4步，赠品收货
    function add_zshouhuo() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/zshouhuo_add.htm",
            width: 800,
            height: 600,
            title: "添加赠品收货信息",
            buttons: [{
                id: 'b4',
                text: '添加收货信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_zshouhuo_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'zshouhuo';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadperson").html(r[0].uploadperson);
                $("#uploadremark").html(r[0].uploadremark);
                $("#testrealdate").html(r[0].testrealdate);
                $("#testremark").html(r[0].testremark);
                $("#testperson").html(r[0].testperson);
                //未成品
                $("#zRecrealdate").val(r[0].zRecrealdate);
                $("#zRecnum").val(r[0].zRecnum);
                $("#zRecremark").val(r[0].zRecremark);


            }
        });
        showbutton(flag);


    }
    //第5步未成品入库
    function add_weichengpin() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/weichengpin_add.htm",
            width: 800,
            height: 600,
            title: "添加未成品入库",
            buttons: [
                {
                    id: 'b4',
                    text: '添加未成品入库',
                    iconCls: 'icon-edit',
                    handler: function () {
                        //alert("");
                        var d = $(this).closest('.window-body');
                        $("#f_weichengpin_add").form("submit", {
                            url: "../ashx_ui/ui_gongyingshang.ashx",
                            onSubmit: function (param) {
                                param.action = 'weichengpin';
                                param.id = r[0].id;
                                return $(this).form('validate');
                            },
                            success: function (result) {
                                dealAjaxResult(result, function (r) {
                                    d.dialog('destroy');
                                    $.show_warning("提示", "操作成功");
                                    $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                                });
                            }
                        });
                    }
                },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#recrealdate").html(r[0].recrealdate);
                $("#recnum").html(r[0].recnum);
                $("#testrealdate").html(r[0].testrealdate);
                //
                $("#unfinishrealdate").val(r[0].unfinishrealdate);
                $("#unfinishnum").val(r[0].unfinishnum);
                $("#unfinishremark").val(r[0].unfinishremark);

            }
        });
        showbutton(flag);
    }
    //第四步
    function add_chengpin() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/chengpin_add.htm",
            width: 800,
            height: 600,
            title: "添加成品信息",
            buttons: [
                {
                    id: 'b4',
                    text: '添加成品信息',
                    iconCls: 'icon-edit',
                    handler: function () {
                        //alert("");
                        var d = $(this).closest('.window-body');
                        $("#f_chengpin_add").form("submit", {
                            url: "../ashx_ui/ui_gongyingshang.ashx",
                            onSubmit: function (param) {
                                param.action = 'chengpin';
                                param.id = r[0].id;
                                return $(this).form('validate');
                            },
                            success: function (result) {
                                dealAjaxResult(result, function (r) {
                                    d.dialog('destroy');
                                    $.show_warning("提示", "操作成功");
                                    $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                                });
                            }
                        });
                    }
                },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#recrealdate").html(r[0].recrealdate);
                $("#recnum").html(r[0].recnum);
                $("#testrealdate").html(r[0].testrealdate);
                //
                $("#unfinishrealdate").html(r[0].unfinishrealdate);
                $("#unfinishnum").html(r[0].unfinishnum);

                $("#finishrealdate").val(r[0].finishrealdate);
                $("#finishnum").val(r[0].finishnum);
                $("#finishremark").val(r[0].finishremark);
            }
        });
        //是否显示保存提交按钮
        showbutton(flag);
    }
    //4包装
    function add_baozhuang() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/baozhuang_add.htm",
            width: 800,
            height: 600,
            title: "添加包装入库信息",
            buttons: [{
                id: 'b4',
                text: '添加包装入库信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_baozhuang_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'baozhuang';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function() {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#recrealdate").html(r[0].recrealdate);
                $("#recnum").html(r[0].recnum);
                $("#testrealdate").html(r[0].testrealdate);
                //
                $("#unfinishrealdate").html(r[0].unfinishrealdate);
                $("#unfinishnum").html(r[0].unfinishnum);

                $("#packrealdate").val(r[0].packrealdate);
                $("#packnum").val(r[0].packnum);
                $("#packremark").val(r[0].packremark);

            }


        });
        showbutton(flag);
    }
    function add_feiziyou() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/feiziyou_add.htm",
            width: 800,
            height: 600,
            title: "添加非自有入库信息",
            buttons: [{
                id: 'b4',
                text: '添加非自有入库信息',
                iconCls: 'icon-edit',
                handler: function () {
                    //alert("");
                    var d = $(this).closest('.window-body');
                    $("#f_feiziyou_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'feiziyou';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#recrealdate").html(r[0].recrealdate);
                $("#recnum").html(r[0].recnum);
                $("#testrealdate").html(r[0].testrealdate);
                //
                $("#noselfrealdate").val(r[0].noselfrealdate);
                $("#noselfnum").val(r[0].noselfnum);
                $("#noselfremark").val(r[0].noselfremark);

            }
        });
        showbutton(flag);
    }
    //赠品录入
    function add_zengpin() {
        flag = 4;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/zengpin_add.htm",
            width: 800,
            height: 600,
            title: "添加赠品入库信息",
            buttons: [{
                id: 'b4',
                text: '添加赠品入库信息',
                iconCls: 'icon-edit',
                handler: function () {
                    //alert("");
                    var d = $(this).closest('.window-body');
                    $("#f_zengpin_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'zengpin';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#arrdate").html(r[0].arrdate);
                $("#dep").html(r[0].dep);
                $("#category").html(r[0].category);
                $("#suppliername").html(r[0].suppliername);
                $("#suppliertel").html(r[0].suppliertel);
                $("#total").html(r[0].total);
                $("#uploadrealdate").html(r[0].uploadrealdate);
                $("#uploadnum").html(r[0].uploadnum);
                $("#recrealdate").html(r[0].recrealdate);
                $("#recnum").html(r[0].recnum);
                $("#testrealdate").html(r[0].testrealdate);
                //
                $("#noselfrealdate").val(r[0].noselfrealdate);
                $("#noselfnum").val(r[0].noselfnum);
                $("#noselfremark").val(r[0].noselfremark);

            }
        });
        showbutton(flag);
    }

    function add_buliangpin() {
        flag = 5;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }

        $("<div />").dialog({
            href: "htm_ui/gongyingshang/buliangpin_add.htm",
            width: 800,
            height: 600,
            title: "添加不良品信息",
            buttons: [{
                id: 'b5',
                text: '添加不良品信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_buliangpin_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'buliangpin';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }
        });
        showbutton(flag);
    }
    function add_chonggong() {
        flag = 5;
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_gongyingshang").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div />").dialog({
            href: "htm_ui/gongyingshang/chonggong_add.htm",
            width: 800,
            height: 600,
            title: "添加重工入库信息",
            buttons: [{
                id: 'b5',
                text: '添加重工入库信息',
                iconCls: 'icon-edit',
                handler: function () {
                    var d = $(this).closest('.window-body');
                    $("#f_chonggong_add").form("submit", {
                        url: "../ashx_ui/ui_gongyingshang.ashx",
                        onSubmit: function (param) {
                            param.action = 'chonggong';
                            param.id = r[0].id;
                            return $(this).form('validate');
                        },
                        success: function (result) {
                            dealAjaxResult(result, function (r) {
                                d.dialog('destroy');
                                $.show_warning("提示", "操作成功");
                                $("#dg_gongyingshang").datagrid("reload").datagrid('clearSelections').datagrid('clearChecked');
                            });
                        }
                    });
                }
            },
                {
                    text: '取消修改',
                    iconCls: 'icon-cancel',
                    handler: function () { $(this).closest('.window-body').dialog('destroy'); }

                }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            }
        });
        showbutton(flag);
    }
    ///权限控制
    function quanxian() {

        for (var i = 1; i <= 17; i++) {
            $("#a" + i).hide();
        }
        var userid;
        getSession(function f(r) {
            var user = $.parseJSON(r);
            userid = user.id;
            $.ajax({
                type: 'Get',
                url: '../ashx_ui/quanxian.ashx?action=quanxian&userid=' + userid,
                dataType: 'json',
                success: function (data) {
                    $.each(data, function (index, item) {
                        if (item.userid) {
                            $("#a" + item.user_right).show();

                        }
                    });

                }
            });

        });
    }

    //按钮显示控制
    function showbutton(flag) {
        var r = $("#dg_gongyingshang").datagrid("getChecked");
        var id = r[0].id;
        $.ajax({
            type: 'POST',
            url: '../ashx_ui/quanxian.ashx?action=isshow&id=' + id,
            dataType: 'json',
            success: function (data) {
                // debugger;
                if (flag == data || flag == data + 1) {
                    $("#b" + flag).show();
                } else {
                    $("#b" + flag).hide();
                }
            }
        });
    }
</script>
<div class="easyui-layout" data-options="fit : true,border : false">
    <div data-options="region:'north',title:'查询条件',border:false,iconCls:'icon-columns'"
        style="height: 100px; background: #f4f4f4;">
        <div>
            <form id="ff_form">
            <table>
                <tr>
                    <td>
                        关键字
                    </td>
                    <td>
                        <input type="text" id="ff_search" />
                    </td>
                    <td>
                        <a id="btn" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'"
                            onclick="doSearch();">搜索</a>
                </tr>
            </table>
            </form>
        </div>
    </div>
    <div data-options="region:'center',border:false">
        <table id="dg_gongyingshang">
        </table>
    </div>
</div>
