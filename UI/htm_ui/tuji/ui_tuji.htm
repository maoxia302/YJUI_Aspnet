<script type="text/javascript">
    $(function () {
        $("#dg_tuji").datagrid({
            url: "../ashx_ui/TUJI.ashx?action=search",
            idField: 'ID',
            fit: true,
            fitColumns: false,
            singleSelect: true,
            rownumbers: false,
            nowrap: false,
            pagination: true,
            pageSize: 30,
            pageList: [30, 40, 50],
            //冻结列
            columns: [[{ "title": "反馈内容", "colspan": 13 }, { title: "2个工作日响应", colspan: 8}],
            [
                    { field: "ID", title: "序号", width: 30 },
                    { field: "tjxh", title: "凸机型号", width: 60 },
                    { field: "fdjh", title: "发动机号", width: 100 },
                    { field: "NewHao", title: "新发动机号", width: 100 },
                { field: "zjsj", title: "装机时间", width: 80 },
                { field: "brand", title: "品牌", width: 80 },
                    { field: "jhbx", title: "激活保修", width: 50 },
                    { field: "gzfsdq", title: "代理地址", width: 80 },
                    { field: "dls", title: "代理商", width: 100 },
                    { field: "xlc", title: "修理厂", width: 100 },
                    { field: "lxr", title: "联系人", width: 60 },
                    { field: "xlctel", title: "联系电话", width: 80 },
                    { field: "xxfksj", title: "反馈时间", width: 75 },
                    { field: "xxfkr", title: "反馈人", width: 60 },
                    { field: "gzxx", title: "故障现象描述", width: 150 },
                    { field: "fenlei", title: "分类", width: 50 },
                    { field: "gzms", title: "故障类型", width: 150 },
                    {field: "shclsj", title: "售后处理时间", width: 80},
                    { field: "zdfx", title: "诊断分析", width: 150 },
                    { field: "gznr", title: "售后处理结果", width: 180 },
                    { field: "zpje", title: "故障件", width: 100 },
                    { field: "xxzrr", title: "售后处理人", width: 60 },
                    { field: "shclyj", title: "售后完成情况", width: 80 },

                    { field: "thhfjg", title: "回访结果", width: 150 },
                    { field: "jjfh", title: "旧件返还", width: 60 },

                    { field: "fkname", title: "分库名称", width: 80 },
                    { field: "fkdhrq", title: "分库到货日期", width: 80 },
                    { field: "dhrq", title: "总库收货日期", width: 80 },
                    { field: "gongchangshrq", title: "工厂到货日期", width: 80 },
                     {field: "cjrq", title: "拆解日期", width: 70 },
                     { field: "cjr", title: "拆解人", width: 60 },
                     { field: "cjfk", title: "折解结果", width: 100 },
                     { field: "gzbw", title: "故障部位", width: 100 },
                     { field: "zlpd", title: "质量判断", width: 70 },
                     { field: "shcjqr", title: "售后拆检结果确认", width: 100 },
                    { field: "gjzrr", title: "改进责任人", width: 60 },
                    { field: "gjfa", title: "初步改进方案", width: 200 },
                    { field: "gjrq", title: "改进日期", width: 70 },
                    { field: "kcclcs", title: "库存处理措施", width: 100 },
                    { field: "kcwcrq", title: "完成日期", width: 70 },
                    { field: "gysclcs", title: "供应商处理措施", width: 200 },
                    { field: "gyswcrq", title: "完成日期", width: 70 },
                    { field: "nblcgs", title: "内部流程工艺改善", width: 250 },
                    { field: "nblcwcrq", title: "完成日期", width: 70 },
                    { field: "qtgjcs", title: "其它改进措施", width: 70 },
                    { field: "qtwcrq", title: "完成日期", width: 70 },
                    { field: "bs", title: "结束", width: 50 },  //改进结束
                     {field: "cpbqr", title: "产品部确认", width: 70 },  //产品部确认
                     {field: "cpbrq", title: "产品部确认日期", width: 70 },  //产品部确认日期
                    {field: "gcqr", title: "工厂确认", width: 100 },
                    { field: "gcqrrq", title: "工厂确认日期", width: 80 }

                ]
            ],
            toolbar: [
                {
                    id:'a1',
                    text: '添加凸机台账信息',
                    iconCls: 'icon-edit',
                    handler: add_tuji

                }, '-',
                {
                    id:'a2',
                    text: '编辑凸机台账信息',
                    iconCls: 'icon-edit',
                    handler: tuji_update

                }, '-',
                {
                    text: '售后处理',
                    iconCls: 'icon-org',
                    handler: xiangying

                }, '-',
                {
                    text: '回访结果',
                    iconCls: 'icon-org',
                    handler: huifang

                }, '-',
                {
                    text: '分库到货',
                    iconCls: 'icon-org',
                    handler: fenku

                }, '-', {
                    text: '总库到货',
                    iconCls: 'icon-org',
                    handler: zongku

                }, '-',
                {
                    text: '工厂到货',
                    iconCls: 'icon-org',
                    handler: gcdaohuo

                }, '-',
                {
                    text: '旧机拆解分析',
                    iconCls: 'icon-org',
                    handler: chaijian

                }, '-',
                {
                    text: '问题整改',
                    iconCls: 'icon-org',
                    handler: zhenggai

                }, '-',
                {
                    text: '产品部确认',
                    iconCls: 'icon-org',
                    handler: chanpinbu

                }, '-',
                {
                    text: '工厂确认',
                    iconCls: 'icon-org',
                    handler: gongchang

                }
            ]
        });
        quanxian();
    });
    function quanxian() {
        $("#a2").hide();
        var userid;
        getSession(function f(r) {
            var user = $.parseJSON(r);
            username = user.account;
            if(username=='admin'|| username=='李鹏')
            {
                $("#a2").show();
            }


        });
    }

    function yanqi(row, index) {
        var rows = $('#dg_tuji').datagrid('getRows');
        var fksj = rows[index].xxfksj; //获得反馈时间
        var clsj = rows[index].shclsj; //获得售后处理时间
        var fkdate = new Date(fksj.substr(0, 4), fksj.substr(4, 2) - 1, fksj.substr(6, 2));
        var cldate = new Date(clsj.substr(0, 4), clsj.substr(4, 2) - 1, clsj.substr(6, 2));
        var days = new Date(fkdate.getTime() - cldate.getTime()) / 24 / 60 / 60 / 1000;
        if (days >= 2) {
            return 'background-color:#ffee00;color:red;';
        }

    }
    function gongchang() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        //判断权限
        $("<div/>").dialog({
            href: "htm_ui/tuji/gongchang.htm",
            title: "工厂确认",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_gongchang_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'gongchang';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况

                $("#thhfjg").html(r[0].thhfjg); //客户回访结果
                $("#dhqr").html(r[0].dhqr);
                $("#dhrq").html(r[0].dhrq);
                //拆检分析
                $("#cjrq").html(r[0].cjrq);
                $("#cjr").html(r[0].cjr);
                $("#cjfk").html(r[0].cjfk);
                $("#gzbw").html(r[0].gzbw);
                $("#zlpd").html(r[0].zlpd);
                //问题整改
                $("#gjzrr").html(r[0].gjzrr);
                $("#gjfa").html(r[0].gjfa);
                $("#gjrq").html(r[0].gjrq);
                $("#kcclcs").html(r[0].kcclcs);
                $("#kcwcrq").html(r[0].kcwcrq);
                $("#gysclcs").html(r[0].gysclcs);
                $("#gyswcrq").html(r[0].gyswcrq);
                $("#nblcgs").html(r[0].nblcgs);
                $("#nblcwcrq").html(r[0].nblcwcrq);
                $("#qtgjcs").html(r[0].qtgjcs);
                $("#qtwcrq").html(r[0].qtwcrq);
                $("#gjjs").html(r[0].gjjs);
                $("#f_gongchang_add").form("load", r[0]);
            }
        });
    }
    function chanpinbu() {
        //判断权限
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/chanpinbu.htm",
            title: "产品部确认",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_chanpinbu_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'chanpinbu';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况
                $("#thhfjg").html(r[0].thhfjg); //客户回访结果
                $("#dhqr").html(r[0].dhqr);
                $("#dhrq").html(r[0].dhrq);
                //拆检分析
                $("#cjrq").html(r[0].cjrq);
                $("#cjr").html(r[0].cjr);
                $("#cjfk").html(r[0].cjfk);
                $("#gzbw").html(r[0].gzbw);
                $("#zlpd").html(r[0].zlpd);
                //问题整改
                $("#gjzrr").html(r[0].gjzrr);
                $("#gjfa").html(r[0].gjfa);
                $("#gjrq").html(r[0].gjrq);
                $("#kcclcs").html(r[0].kcclcs);
                $("#kcwcrq").html(r[0].kcwcrq);
                $("#gysclcs").html(r[0].gysclcs);
                $("#gyswcrq").html(r[0].gyswcrq);
                $("#nblcgs").html(r[0].nblcgs);
                $("#nblcwcrq").html(r[0].nblcwcrq);
                $("#qtgjcs").html(r[0].qtgjcs);
                $("#qtwcrq").html(r[0].qtwcrq);
                $("#gjjs").html(r[0].gjjs);
                $("#f_chanpinbu_add").form("load", r[0]);
            }

        });
    }
    function add_tuji() {
        //判断权限
        $("<div/>").dialog({
            href: "htm_ui/tuji/tuji_add.htm",
            title: "添加凸机台账信息",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_tuji_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'add_info';
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid("reload");
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                //加载经办人
                getSession(function f(r) {
                    var user = $.parseJSON(r);
                    $("#fkr").val(user.xingming);
                });

            }
        });
    }
    //修改凸机台账信息资料
    function tuji_update() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/tuji_update.html",
            title: "编辑凸机台账信息",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_tuji_update").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'update';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
            ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            //加载到
            onLoad: function () {
                //$("#zjsj").val(r[0].zjsj);
                $("#f_tuji_update").form("load", r[0]);
            }

        });
    }
    function xiangying() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/xiangying.htm",
            title: "售后相应处理",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_xiangying_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'xiangying';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                $('#cb_guzhangjian').combobox('setValue', r[0].zpje);
                $('#cb_guzhangjian').combobox('setText', r[0].zpje);
                $('#cb_gzfl').combobox('setValue', r[0].gzms);
                $('#cb_gzfl').combobox('setText', r[0].gzms);
                $("#f_xiangying_add").form("load", r[0]);
            }

        });
    }
    function huifang() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/huifang.htm",
            title: "回访结果填写",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_huifang_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'huifang';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）

                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况
                $("#f_huifang_add").form("load", r[0]);
            }
        });
    }
    //daohuo
    function fenku() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/daohuo.htm",
            title: "到货确认",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_daohuo_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'fenku';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况
                $("#thhfjg").html(r[0].thhfjg);
                $("#f_daohuo_add").form("load", r[0]);
            }
        });
    }
    function gcdaohuo() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/gcdaohuo.htm",
            title: "到货确认",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_daohuo_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'gcdaohuo';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况
                $("#thhfjg").html(r[0].thhfjg);
                $("#f_daohuo_add").form("load", r[0]);
            }
        });
    }

    function zongku() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }
        $("<div/>").dialog({
            href: "htm_ui/tuji/zkdaohuo.htm",
            title: "到货确认",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定添加',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_daohuo_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         param.action = 'zongku';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消添加',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况
                $("#thhfjg").html(r[0].thhfjg);
                $("#f_daohuo_add").form("load", r[0]);
            }
        });
    }
    function chaijian() {
        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }

        $("<div/>").dialog({
            href: "htm_ui/tuji/chaijian.htm",
            title: "旧机拆检分析",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');

                                 $("#f_chaijian_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {

                                         param.action = 'chaijian';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            },
            onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况

                $("#f_chaijian_add").form("load", r[0]);

            }
        });
    }
    function zhenggai() {

        var r = $("#dg_tuji").datagrid("getChecked");
        if (r.length < 1) {
            $.show_warning("错误", "请选择一个要修改一个信息");
            return;
        }
        if (r.length > 1) {
            $.show_warning("错误", "一次只能修改一个信息");
            $("#dg_tuji").datagrid('clearSelections').datagrid('clearChecked');
            return;
        }

        $("<div/>").dialog({
            href: "htm_ui/tuji/zhenggai.htm",
            title: "问题整改",
            height: 600,
            width: 600,
            modal: true,
            iconCls: "icon-add",
            buttons: [
                         {
                             text: '确定',
                             iconCls: 'icon-add',
                             handler: function () {
                                 var d = $(this).closest('.window-body');
                                 $("#f_zhenggai_add").form("submit", {
                                     url: "../ashx_ui/TUJI.ashx",
                                     onSubmit: function (param) {
                                         var gjfa = $("#gjfa").val();

                                         //alert(gjfa);
                                         param.action = 'zhenggai';
                                         param.ID = r[0].ID;
                                         return $(this).form('validate');
                                     },
                                     success: function (result) {
                                         dealAjaxResult(result, function (r) {
                                             d.dialog('destroy');
                                             $.show_warning("提示", "操作成功");
                                             $("#dg_tuji").datagrid('reload').datagrid('clearSelections').datagrid('clearChecked');
                                         });
                                     }
                                 });
                             }
                         },
                         {
                             text: '取消',
                             iconCls: 'icon-cancel',
                             handler: function () { $(this).closest('.window-body').dialog('destroy'); }
                         }
                ],
            onClose: function () {
                $(this).dialog('destroy');
            }, onLoad: function () {
                $("#tjxh").html(r[0].tjxh);
                $("#fdjh").html(r[0].fdjh);
                $("#jhbx").html(r[0].jhbx);
                $("#zjsj").html(r[0].zjsj);
                $("#gzfsdq").html(r[0].gzfsdq);
                $("#dls").html(r[0].dls);
                $("#xlc").html(r[0].xlc);
                $("#lxr").html(r[0].lxr);
                $("#xlctel").html(r[0].xlctel);
                $("#xxfkr").html(r[0].xxfkr);
                $("#xxfksj").html(r[0].xxfksj);
                $("#gzxx").html(r[0].gzxx);
                //（售后处理）
                $("#fenlei").html(r[0].fenlei);
                $("#gzms").html(r[0].gzms);
                $("#shclsj").html(r[0].shclsj);
                $("#zdfx").html(r[0].zdfx);
                $("#gznr").html(r[0].gznr);
                $("#zpje").html(r[0].zpje);
                $("#xxzrr").html(r[0].xxzrr);
                $("#shclyj").html(r[0].shclyj); //售后完成情况

                $("#thhfjg").html(r[0].thhfjg); //客户回访结果
                $("#dhqr").html(r[0].dhqr);
                $("#dhrq").html(r[0].dhrq);
                //拆检分析
                $("#cjrq").html(r[0].cjrq);
                $("#cjr").html(r[0].cjr);
                $("#cjfk").html(r[0].cjfk);
                $("#gzbw").html(r[0].gzbw);
                $("#zlpd").html(r[0].zlpd);
                $("#f_zhenggai_add").form("load", r[0]);
            }
        });
    }
    function Search() {
        $('#dg_tuji').datagrid('load', {//combobox获取value
            selectDate: $("#selectDate").combobox("getValue"),
            bdate: $('#bdate').val(),
            edate: $('#edate').val(),
            //chk: document.getElementById('chk').checked,
            txtWord: $('#txtWord').val()
        });
    }
    function toexcel() {
        var selectDate = $("#selectDate").combobox("getValue");
        var begindate = $('#bdate').val();
        var enddate = $('#edate').val();
        if (begindate == "" || enddate == "") {
            alert("请选择开始日期和结束日期");
        } else {
            window.open("../ashx_ui/export.ashx?action=export_tuji&selectDate=" + selectDate + "&begindate=" + begindate + "&enddate=" + enddate);
        }

    }
</script>
<div class="easyui-layout" data-options="fit : true,border : false">
    <div data-options="region:'north',title:'查询条件',border:false,iconCls:'icon-columns'"
        style="height: 100px; background: #f4f4f4;">
        <div>
            <form id="ff" method="POST">
            <table>
                <tr>
                    <td>
                        选择要查询的日期属性：
                    </td>
                    <td>
                        <input class="easyui-combobox" id="selectDate" data-options="
		                    valueField: 'label',
		                    textField: 'value',
		                    data: [{
			                    label: 'xxfksj',
			                    value: '反馈时间',
                                selected:true
		                    },{
			                    label: 'dhrq',
			                    value: '旧件到库时间'
		                    },{
			                    label: 'cjrq',
			                    value: '拆检时间'
		                    }]" />
                        <input type="text" id="bdate" class="Wdate" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" />
                        至
                        <input type="text" id="edate" class="Wdate" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" />
                    </td>
                </tr>
                <tr>
                    <td>
                        <!-- <input type="checkbox" id="chk" />-->
                        关键字:
                    </td>
                    <td>
                        <input type="text" id="txtWord" style="height: 20px;" />
                    </td>
                    <td>
                        <a id="btn1" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'"
                            onclick="Search();">搜索</a> <a id="A1" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'"
                                onclick="toexcel();">导出</a>
                    </td>
                </tr>
            </table>
            </form>
        </div>
    </div>
    <div data-options="region:'center',border:false">
        <table id="dg_tuji">
        </table>
    </div>
</div>
